#!/usr/bin/env ruby

require_relative '../lib/rapicco'

def print_usage
  puts "Usage: rapicco [options] <slide.md> <output.pdf>"
  puts ""
  puts "Options:"
  puts "  --rapicco-command CMD    Command to run Rapicco (default: auto-detect)"
  puts "  --cols NUMBER            Terminal columns (default: 80)"
  puts "  --rows NUMBER            Terminal rows (default: 24)"
  puts "  --char-width NUMBER      Character width in pixels (default: 10)"
  puts "  --char-height NUMBER     Character height in pixels (default: 20)"
  puts "  -h, --help               Show this help message"
  puts ""
  puts "Example:"
  puts "  rapicco presentation.md output.pdf"
  puts "  rapicco --cols 100 --rows 30 presentation.md output.pdf"
end

options = {}
args = []

i = 0
while i < ARGV.length
  case ARGV[i]
  when '-h', '--help'
    print_usage
    exit 0
  when '--rapicco-command'
    options[:rapicco_command] = ARGV[i + 1]
    i += 1
  when '--cols'
    options[:cols] = ARGV[i + 1].to_i
    i += 1
  when '--rows'
    options[:rows] = ARGV[i + 1].to_i
    i += 1
  when '--char-width'
    options[:char_width] = ARGV[i + 1].to_i
    i += 1
  when '--char-height'
    options[:char_height] = ARGV[i + 1].to_i
    i += 1
  else
    args << ARGV[i]
  end
  i += 1
end

if args.length != 2
  puts "Error: Please provide both input and output files"
  puts ""
  print_usage
  exit 1
end

slide_file = args[0]
output_pdf = args[1]

unless File.exist?(slide_file)
  puts "Error: Input file not found: #{slide_file}"
  exit 1
end

begin
  converter = Rapicco::PDF::Converter.new(slide_file, output_pdf, options)
  converter.convert
rescue => e
  puts "Error: #{e.message}"
  puts e.backtrace if ENV['DEBUG']
  exit 1
end
